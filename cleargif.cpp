#include "cleargif.hpp"

using namespace lb;

/* data statements for file httpclear.gif at Thu Feb 14 13:58:57 2013 */
/* Generated by BIN2C, G.Vanem 1995 */


/*
HTTP/1.1 200 OK
Content-Type: image/gif
Content-Length: 43
Cache-Control: no-cache, no-store, must-revalidate, no-cache=Set-Cookie, max-age=0, proxy-revalidate
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Pragma: no-cache
Connection: close
*/
const unsigned char CLEAR_GIF_CLOSE[] = {0x48,0x54,0x54,0x50,0x2F,0x31,0x2E,0x31,0x20,0x32,0x30,0x30,
  0x20,0x4F,0x4B,0x0D,0x0A,0x43,0x6F,0x6E,0x74,0x65,0x6E,0x74,
  0x2D,0x54,0x79,0x70,0x65,0x3A,0x20,0x69,0x6D,0x61,0x67,0x65,
  0x2F,0x67,0x69,0x66,0x0D,0x0A,0x43,0x6F,0x6E,0x74,0x65,0x6E,
  0x74,0x2D,0x4C,0x65,0x6E,0x67,0x74,0x68,0x3A,0x20,0x34,0x33,
  0x0D,0x0A,0x43,0x61,0x63,0x68,0x65,0x2D,0x43,0x6F,0x6E,0x74,
  0x72,0x6F,0x6C,0x3A,0x20,0x6E,0x6F,0x2D,0x63,0x61,0x63,0x68,
  0x65,0x2C,0x20,0x6E,0x6F,0x2D,0x73,0x74,0x6F,0x72,0x65,0x2C,
  0x20,0x6D,0x75,0x73,0x74,0x2D,0x72,0x65,0x76,0x61,0x6C,0x69,
  0x64,0x61,0x74,0x65,0x2C,0x20,0x6E,0x6F,0x2D,0x63,0x61,0x63,
  0x68,0x65,0x3D,0x53,0x65,0x74,0x2D,0x43,0x6F,0x6F,0x6B,0x69,
  0x65,0x2C,0x20,0x6D,0x61,0x78,0x2D,0x61,0x67,0x65,0x3D,0x30,
  0x2C,0x20,0x70,0x72,0x6F,0x78,0x79,0x2D,0x72,0x65,0x76,0x61,
  0x6C,0x69,0x64,0x61,0x74,0x65,0x0D,0x0A,0x45,0x78,0x70,0x69,
  0x72,0x65,0x73,0x3A,0x20,0x54,0x68,0x75,0x2C,0x20,0x30,0x31,
  0x20,0x4A,0x61,0x6E,0x20,0x31,0x39,0x37,0x30,0x20,0x30,0x30,
  0x3A,0x30,0x30,0x3A,0x30,0x30,0x20,0x47,0x4D,0x54,0x0D,0x0A,
  0x50,0x72,0x61,0x67,0x6D,0x61,0x3A,0x20,0x6E,0x6F,0x2D,0x63,
  0x61,0x63,0x68,0x65,0x0D,0x0A,0x43,0x6F,0x6E,0x6E,0x65,0x63,
  0x74,0x69,0x6F,0x6E,0x3A,0x20,0x63,0x6C,0x6F,0x73,0x65,
  0x0D,0x0A,0x0D,0x0A, // <- \r\n\r\n
  0x47,0x49,0x46,0x38,0x39,0x61,0x01,0x00,0x01,
  0x00,0x80,0x01,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x21,0xF9,
  0x04,0x01,0x00,0x00,0x01,0x00,0x2C,0x00,0x00,0x00,0x00,0x01,
	0x00,0x01,0x00,0x00,0x02,0x02,0x4C,0x01,0x00,0x3B};


/*
HTTP/1.1 200 OK
Content-Type: image/gif
Content-Length: 43
Cache-Control: no-cache, no-store, must-revalidate, no-cache=Set-Cookie, max-age=0, proxy-revalidate
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Pragma: no-cache
Connection: keep-alive
*/

const unsigned char CLEAR_GIF_KEEP[] = {0x48,0x54,0x54,0x50,0x2F,0x31,0x2E,0x31,0x20,0x32,0x30,0x30,
  0x20,0x4F,0x4B,0x0D,0x0A,0x43,0x6F,0x6E,0x74,0x65,0x6E,0x74,
  0x2D,0x54,0x79,0x70,0x65,0x3A,0x20,0x69,0x6D,0x61,0x67,0x65,
  0x2F,0x67,0x69,0x66,0x0D,0x0A,0x43,0x6F,0x6E,0x74,0x65,0x6E,
  0x74,0x2D,0x4C,0x65,0x6E,0x67,0x74,0x68,0x3A,0x20,0x34,0x33,
  0x0D,0x0A,0x43,0x61,0x63,0x68,0x65,0x2D,0x43,0x6F,0x6E,0x74,
  0x72,0x6F,0x6C,0x3A,0x20,0x6E,0x6F,0x2D,0x63,0x61,0x63,0x68,
  0x65,0x2C,0x20,0x6E,0x6F,0x2D,0x73,0x74,0x6F,0x72,0x65,0x2C,
  0x20,0x6D,0x75,0x73,0x74,0x2D,0x72,0x65,0x76,0x61,0x6C,0x69,
  0x64,0x61,0x74,0x65,0x2C,0x20,0x6E,0x6F,0x2D,0x63,0x61,0x63,
  0x68,0x65,0x3D,0x53,0x65,0x74,0x2D,0x43,0x6F,0x6F,0x6B,0x69,
  0x65,0x2C,0x20,0x6D,0x61,0x78,0x2D,0x61,0x67,0x65,0x3D,0x30,
  0x2C,0x20,0x70,0x72,0x6F,0x78,0x79,0x2D,0x72,0x65,0x76,0x61,
  0x6C,0x69,0x64,0x61,0x74,0x65,0x0D,0x0A,0x45,0x78,0x70,0x69,
  0x72,0x65,0x73,0x3A,0x20,0x54,0x68,0x75,0x2C,0x20,0x30,0x31,
  0x20,0x4A,0x61,0x6E,0x20,0x31,0x39,0x37,0x30,0x20,0x30,0x30,
  0x3A,0x30,0x30,0x3A,0x30,0x30,0x20,0x47,0x4D,0x54,0x0D,0x0A,
  0x50,0x72,0x61,0x67,0x6D,0x61,0x3A,0x20,0x6E,0x6F,0x2D,0x63,
  0x61,0x63,0x68,0x65,0x0D,0x0A,0x43,0x6F,0x6E,0x6E,0x65,0x63,
  0x74,0x69,0x6F,0x6E,0x3A,0x20,'k','e','e','p','-','a','l','i','v','e',
  0x0D,0x0A,0x0D,0x0A,// <- \r\n\r\n
  0x47,0x49,0x46,0x38,0x39,0x61,0x01,0x00,0x01,
  0x00,0x80,0x01,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x21,0xF9,
  0x04,0x01,0x00,0x00,0x01,0x00,0x2C,0x00,0x00,0x00,0x00,0x01,
	0x00,0x01,0x00,0x00,0x02,0x02,0x4C,0x01,0x00,0x3B};


void ClearGif::Form(RString &buf, bool isKeepAlive)
{
	buf.Null();
	if (isKeepAlive)
		buf.AddStr((const char*)CLEAR_GIF_KEEP, sizeof(CLEAR_GIF_KEEP));
	else
		buf.AddStr((const char*)CLEAR_GIF_CLOSE, sizeof(CLEAR_GIF_CLOSE));
}

void ClearGif::Form(RString &buf, RString &cookies, bool isKeepAlive)
{
	if (cookies.Length() > 0)
	{
		buf.Null();
		if(isKeepAlive)
		{
			static const int HEADERS_END_KEEP  = 246;
			buf.Add((const char*)CLEAR_GIF_CLOSE, HEADERS_END_KEEP);
			buf.Add(cookies.Data(), cookies.Length());
			buf.AddStr((const char*)CLEAR_GIF_CLOSE + HEADERS_END_KEEP, sizeof(CLEAR_GIF_CLOSE) - HEADERS_END_KEEP);
		}
		else
		{
			static const int HEADERS_END_CLOSE  = 241;
			buf.Add((const char*)CLEAR_GIF_CLOSE, HEADERS_END_CLOSE);
			buf.Add(cookies.Data(), cookies.Length());
			buf.AddStr((const char*)CLEAR_GIF_CLOSE + HEADERS_END_CLOSE, sizeof(CLEAR_GIF_CLOSE) - HEADERS_END_CLOSE);
		}
	}
	else
		Form(buf, isKeepAlive);
}
